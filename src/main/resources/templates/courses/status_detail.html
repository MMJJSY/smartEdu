<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>강좌 상세 보기</title>
  <link rel="stylesheet" th:href="@{/css/admin_dashboard.css}">
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
    }

    .admin-detail {
      max-width: 1000px;
      margin: 40px auto;
      background: #fff;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ddd;
      padding-bottom: 10px;
    }

    .header h2 {
      margin: 0;
      font-size: 1.4em;
    }

    .actions button {
      margin-left: 8px;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-approve {
      background: #28a745;
      color: white;
    }

    .btn-reject {
      background: #dc3545;
      color: white;
    }

    .btn-approve:hover,
    .btn-reject:hover {
      opacity: 0.9;
    }

    .confirm-box {
      display: none;
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      padding: 20px;
      z-index: 999;
      text-align: center;
    }

    .confirm-box button {
      margin: 10px;
      padding: 6px 14px;
    }

    .course-main {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }

    .course-thumb {
      flex: 1;
      background: #ddd;
      border-radius: 8px;
      height: 180px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .course-info {
      flex: 2;
      line-height: 1.8;
    }

    .lecture-table {
      width: 100%;
      margin-top: 30px;
      border-collapse: collapse;
    }

    .lecture-table th,
    .lecture-table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    .lecture-table th {
      background: #f1f1f1;
    }

    .btn-play {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.1em;
    }
  </style>
</head>

<body>
  <main class="admin-detail">

    <div class="header">
      <h2>강좌 상세보기</h2>
      <div class="actions">
        <button class="btn-reject" onclick="confirmAction('NEGATIVE')">반려</button>
        <button class="btn-approve" onclick="confirmAction('POSITIVE')">승인</button>
      </div>
    </div>

    <div class="confirm-box" id="confirmBox">
      <p id="confirmMessage">정말 승인하시겠습니까?</p>
      <button onclick="submitApproval()">예</button>
      <button onclick="closeConfirm()">아니오</button>
    </div>

    <section class="course-main">
      <div class="course-thumb">
        <img th:if="${course.img}" th:src="@{'/upload/course/' + ${course.img}}" alt="썸네일"
          style="width:100%;height:100%;object-fit:cover;border-radius:8px;">
        <span th:if="${course.img == null}">썸네일 없음</span>
      </div>

      <div class="course-info">
        <p><strong>강좌명:</strong> <span th:text="${course.title}"></span></p>
        <p><strong>강사명:</strong> <span th:text="${course.instructorName}"></span></p>
        <p><strong>등록일:</strong> <span th:text="${#dates.format(course.createdAt, 'yyyy-MM-dd')}"></span></p>
        <p><strong>카테고리:</strong> <span th:text="${course.category}"></span></p>
        <p><strong>강좌 소개:</strong> <span th:text="${course.description}"></span></p>
        <p><strong>가격:</strong> <span th:text="${course.price} + '원'"></span></p>
        <p><strong>승인 상태:</strong> <span th:text="${course.approvedStatus}"></span></p>
      </div>
    </section>

    <section class="lecture-list">
      <h3>강의 목록</h3>
      <table class="lecture-table">
        <thead>
          <tr>
            <th>회차</th>
            <th>강의명</th>
            <th>강의 보기</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="lec, stat : ${lectureList}">
            <td th:text="${lec.sectionNo}"></td>
            <td th:text="${lec.title}"></td>
            <td>
              <button class="btn-play"
                th:onclick="|window.open('@{/courses/getVideo(lectuerid=${lec.lectureId})}')|">▶</button>
            </td>
          </tr>
          <tr th:if="${#lists.isEmpty(lectureList)}">
            <td colspan="3">등록된 강의가 없습니다.</td>
          </tr>
        </tbody>
      </table>
    </section>

    <form id="approvalForm" th:action="@{/courses/updateStatus}" method="post">
      <input type="hidden" name="courseId" th:value="${course.courseId}">
      <input type="hidden" name="approvedStatus" id="approvedStatusValue">
    </form>

    <div style="text-align:center; margin-top:20px;">
      <a th:href="@{/courses/status_list}" class="btn-back">목록으로 돌아가기</a>
    </div>
  </main>

  <script>
    let selectedAction = null;

    function confirmAction(status) {
      selectedAction = status;
      const msg = status === 'POSITIVE' ? '정말 승인하시겠습니까?' : '정말 반려하시겠습니까?';
      document.getElementById('confirmMessage').textContent = msg;
      document.getElementById('confirmBox').style.display = 'block';
    }

    function closeConfirm() {
      document.getElementById('confirmBox').style.display = 'none';
      selectedAction = null;
    }

    function submitApproval() {
      if (!selectedAction) return;
      document.getElementById('approvedStatusValue').value = selectedAction;
      document.getElementById('approvalForm').submit();
    }
  </script>
</body>

</html>