<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>수강생 내 강좌</title>

  <!-- CSS -->
  <link rel="stylesheet" th:href="@{/css/student_class.css}" />
  <link rel="stylesheet" th:href="@{/css/courses.css}">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <link rel="stylesheet" th:href="@{/bootstrap/dist/css/adminlte.min.css}">
</head>

<body>
<section class="mypage-content mycourse">
  <!-- 제목 + 구분선 + 카테고리 셀렉트 -->
  <header class="mc-header">
    <h2 class="mc-title-lg">내 강좌</h2>
    <div class="mc-divider" aria-hidden="true"></div>

    <!-- 카테고리 필터 (GET) -->
    <div class="mc-filterbar">
      <form id="catForm" th:action="@{/dashboard/student}" method="get" style="margin:0;">
        <div class="mc-select" data-open="false">
          <button class="mc-select-trigger" type="button" aria-haspopup="listbox" aria-expanded="false"
                  onclick="toggleSelect(this)">
            <span class="mc-select-value" th:text="${selectedCat != null && selectedCat != '' ? selectedCat : '전체'}">전체</span>
            <svg class="mc-caret" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <ul class="mc-select-menu" role="listbox" tabindex="-1">
            <li role="option" data-value="" th:attr="aria-selected=${selectedCat == null || selectedCat == ''}"
                onclick="selectCat(this)">전체</li>
            <li role="option" th:each="cat : ${categories}"
                th:text="${cat}" th:attr="data-value=${cat}, aria-selected=${selectedCat == cat}"
                onclick="selectCat(this)"></li>
          </ul>
        </div>
        <input type="hidden" name="cat" id="catInput" th:value="${selectedCat}">
      </form>
    </div>
  </header>

  <!-- 강좌 리스트 -->
  <div class="mc-list">
    <!-- 데이터 있을 때 -->
    <a class="mc-rowcard"
       th:each="c : ${myCourses}"
       th:href="@{/courses/detail_common(courseId=${c.courseId}, role='STUDENT', filterType='status')}"
       th:aria-label="${c.title + ' 상세보기'}">
      <div class="mc-row-left">
        <h3 class="row-title" th:text="${c.title}">강좌명</h3>
        <div class="row-meta">
          <span class="meta-val" th:text="${c.category}">카테고리</span>
          <span class="dot">|</span>
          <span class="meta-val" th:text="${c.instructorName}">강사명</span>
        </div>
      </div>

    </a>

    <!-- 데이터 없을 때 -->
    <div class="mc-empty" th:if="${#lists.isEmpty(myCourses)}">
      <p>아직 결제한 강좌가 없습니다.</p>
      <a class="mc-link" th:href="@{/courses/list_common(role='STUDENT', filterType='status')}">강좌 보러가기</a>
    </div>
  </div>
</section>

<!-- JS -->
<script>
  function toggleSelect(btn){
    const box = btn.closest('.mc-select');
    const open = box.getAttribute('data-open') === 'true';
    box.setAttribute('data-open', String(!open));
    btn.setAttribute('aria-expanded', String(!open));
  }
  function selectCat(li){
    const value = li.getAttribute('data-value') || '';
    document.getElementById('catInput').value = value;
    document.getElementById('catForm').submit();
  }
  // 바깥 클릭 닫기
  document.addEventListener('click', (e)=>{
    document.querySelectorAll('.mc-select').forEach(box=>{
      if(!box.contains(e.target)){ box.setAttribute('data-open','false'); }
    });
  });
</script>
</body>
</html>
